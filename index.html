<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Blazin' Docs</title>
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
        <link rel="shortcut icon" type="image/png" href="/pub/favicon.png">
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,700,700italic">
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,600">
        <link rel="stylesheet" href="/pub/basic.css" shim-shadowdom>
        <script src="/bower_components/webcomponentsjs/webcomponents.min.js"></script>

        <link rel="import" href="/bower_components/polymer/polymer.html">
        <link rel="import" href="/bower_components/app-router/app-router.html">
        <link rel="import" href="/bower_components/core-scaffold/core-scaffold.html">
        <link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
        <link rel="import" href="/bower_components/core-toolbar/core-toolbar.html">
        <link rel="import" href="/bower_components/core-field/core-field.html">
        <link rel="import" href="/bower_components/core-icons/core-icons.html">
        <link rel="import" href="/bower_components/core-input/core-input.html">
        <link rel="import" href="/bower_components/core-menu/core-menu.html">
        <link rel="import" href="/bower_components/core-item/core-item.html">
        <link rel="import" href="/bower_components/paper-ripple/paper-ripple.html">
        <link rel="import" href="/bower_components/prism-js/prism-js.html">
    </head>
    <body fullbleed unresolved>
        <polymer-element name="blazin-app">
            <template>
                <link rel="stylesheet" href="/pub/docs.css">
                <link rel="stylesheet" href="/pub/prismjs.css">
                <link rel="stylesheet" href="/pub/blazin.css">
                <core-scaffold drawerWidth="320px" id="appScaffold">
                    <core-header-panel navigation flex mode="seamed">
                        <core-toolbar>
                            <core-field id="searchField">
                                <core-icon icon="search"></core-icon>
                                <input is="core-input" value="{{search}}" placeholder="Search" flex autofocus>
                            </core-field>
                        </core-toolbar>
                        <core-menu id="searchResults" selectedItem="{{selected}}"></core-menu>
                    </core-header-panel>
                    <div tool><core-icon class="heading-icon" icon="bookmark"></core-icon>{{blazingPage}}</div>
                    <div class="content">
                        <app-router mode="hash" id="router" on-activate-route-start="{{loadingPage}}"
                            on-activate-route-end="{{afterLoadingPage}}" init="manual">
                            <app-route path="*" import="/docs/BlazinDocsIndexPage.html" template></app-route>
                        </app-router>
                    </div>
                </core-scaffold>
            </template>

            <script>
                Polymer('blazin-app', {
                    publish: {
                        search: '',
                        blazingPage: 'Blazin\' Docs'
                    },
                    ready: function () {
                        for (var i = 0; i < window.blazinAllPages.length; ++i) {
                            var name = window.blazinAllPages[i]
                            var route = document.createElement('app-route')
                            route.setAttribute('path', '/' + name)
                            route.setAttribute('import', '/docs/' +
                                encodeURIComponent(encodeURIComponent(name)) + '.html')
                            route.setAttribute('template', '')
                            this.$.router.insertBefore(route, this.$.router.firstChild)
                        }
                        this.$.router.init()
                        this.searchIndex = FuzzySet(window.blazinAllPages)
                        this.searchChanged()
                    },
                    loadingPage: function (event) {
                        this.blazingPage = event.detail.path.substr(1) || "Blazin' Docs"
                        this.$.appScaffold.closeDrawer()
                    },
                    afterLoadingPage: function () {
                        try {
                            this.$.appScaffold.$.drawerPanel
                                .getElementsByTagName('core-header-panel')[0]
                                .scroller.scrollTop = 0
                        }
                        catch (_) {}
                    },
                    searchChanged: function () {
                        var html = ''
                        var results = this.search? (this.searchIndex.get(this.search) || []): []
                        var count = Math.min(results.length, 30)
                        for (var i = 0; i < count; ++i) {
                            var res = results[i][1]
                            html += '<core-item icon="bookmark" label="' + res + '">' +
                                    '<a href="#/' + res + '"><paper-ripple fit></paper-ripple></a>' +
                                    '</core-item>'
                        }
                        if (!html) {
                            html = '<div class="nothingFound">Search for a JavaScript object or method, ' +
                                   'such as <code>Function</code> or <code>parseFloat()</code>.</div>'
                        }
                        this.$.searchResults.selected = undefined
                        this.injectBoundHTML(html, this.$.searchResults)
                        if (count == 1)
                            this.$.router.go('/' + results[0][1])
                    }
                })
            </script>
        </polymer-element>

        <script src="/pub/fuzzyset.js"></script>
        <script src="/docs/index.js"></script>
        <blazin-app></blazin-app>
    </body>
</html>
